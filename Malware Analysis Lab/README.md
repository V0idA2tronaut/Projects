# Self-hosted

## Topologia

Hypervisor: VirtualBox

Serão duas VMs
* VM1: Windows10 Enterprise para executar o malware
* VM2: Servidor C2 com REMnux

Completamense isolados da Internet
Podemo comunicar-se entre si, mas apenas entre si


Primeiro, vamos realizar o download do Windows 10
Basta preencher com qualquer informação e clicar em download
Em seguida, escolha sua opção
Nós iremos com Português-BR 64-bits

Para completarmos nossa configuração do Windows base, devemos:
* Memória RAM mínima: 2GB
* Cores mínimos: 2
* Espaço em disco: 70GB

Vamos realizar o donwload de um Web-Browser
Para este, estaremos utilizando o [Chrome](https://www.google.com/intl/pt-BR/chrome/)

Para concluírmos a instalação do Flare, vamos realizar algumas alterações no Windows

Para os toques finais, vamos:
* Desabilitar o Windows Defender
* Desabilitar o Windows Firewall para perfil padrão e
* Desabilitar 

## Instalando Flare

A instalação do Flare começa com o Powershell em modo administrativo
* cd C:\Users\[username]\Desktop
* (New-Object net.webclient).DownloadFile('https://raw.githubusercontent.com/mandiant/flare-vm/main/install.ps1',"$([Environment]::GetFolderPath("Desktop"))\\install.ps1")
* Unblock-File .\install.ps1
* Set-ExecutionPolicy Unrestricted | Selecione _sim_
* .\install.ps1

A última configuração a ser feita é garantir a conexão entre as nossas máquinas
Vamos configurar
Vá para máquina --> configurações --> rede
Selecione host-only
E coloque o _card_ de rede criado anteriormente
Iremos fazer o mesmo com o terminal Remnux
Por fim, vamos alterar o DNS da máquina Windows

Para garantir que todas as configurações de rede estão corretas, vamos usar o comando ping

Agora, tire snapshots de cada uma das máquinas como ponto de partida para futuros projetos

Instalando Remnux

[link_remnux](https://docs.remnux.org/install-distro/get-virtual-appliance)

Para configurar no VirtualBox:
File --> Import Appliances --> /Remnux/Download/path
Basta cliclar em _**iniciar**_


## Criando a própria rede no VirtualBox
* ctrl + h
* clique em _criar_
* altere o endereço IP para: 10.0.0.1
* habilite o servidor DHCP realizando as alterações necessárias caso necessário

Isso vai permitir com que Remnux e nossa máquina Windows Enterprise se comuniquem entre si e apenas entre si, sem acesso a Internet


## Configurando Remnux

No terminal do Remnux, vamos:
* cd /etc/inetsim
* sudo nano inetsim.conf
* retire o _**#**_ de: start_service_dns
* retire o _**#**_ de: service_bind_address e altere o endereço IP para 0.0.0.0
* retire o _**#**_ de: dns_default_ip e altere o endereço IP para 10.0.0.4
